<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>AUTILS | Aerosol size calculator</title>
    <meta name="description"
        content="A simple web app showing the equivalence of different aerosol particle sizes and distribution moments.">
    <meta name="keywords" content="aerosol, particle size, calculator, autils, sipkens">
    <meta name="robots" content="index,follow" />

    <meta name="title" property="og:title" content="AUTILS | Aerosol size calculator">
    <meta name="author" content="Timothy Sipkens">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Used for math and optimization -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://unpkg.com/mathjs/lib/browser/math.js" type="text/javascript"></script>
    <script src="https://unpkg.com/optimization-js@latest/dist/optimization.js" type="text/javascript"></script>

    <link href="https://pro.fontawesome.com/releases/v5.2.0/css/all.css" rel="stylesheet">

    <!-- Load style -->
    <link href="style.css" rel="stylesheet">

    <meta name="theme-color" content="#121212">
    <meta name="color-scheme" content="light dark" />

    <script>
        // Initialize light/dark mode.
        const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
        var dark = prefersDarkScheme.matches;

        // Apply appropriate theme.
        function toggleNight() {
            // Swap CSS.
            document.body.classList.toggle("dark-theme");

            // Update background color
            if (dark) {
                document.querySelector(':root').style.setProperty('--background-color0', '#20293A');
                document.querySelector(':root').style.setProperty('--background-color1', '#181C28');
                document.querySelector(':root').style.setProperty('--background-color2', '#181C28');
                document.querySelector(':root').style.setProperty('--line-color', '#444444');
            } else {
                document.querySelector(':root').style.setProperty('--background-color0', '#EFEFEF');
                document.querySelector(':root').style.setProperty('--background-color1', 'white');
                document.querySelector(':root').style.setProperty('--background-color2', 'white');
                document.querySelector(':root').style.setProperty('--line-color', '#E3E3E3');
            }
        };
    </script>
</head>


<body onload="if (dark) { toggleNight(); }">

    <div class="main">
        <div id="btn-toggle">
            <a id="btn-toggle-click">
                <div>
                    <span><i class="fas fa-moon" id="moon"></i></span>
                    <span><i class="fas fa-sun" id="sun"></i></span>
                    <span></span> <!-- placeholder for dark/light theme toggle -->
                </div>
            </a>
        </div>

        <div class="section">

            <div onclick="expandText(this);" class="h3-container">
                <h3 class="active">
                    GAS PROPERTIES
                    <div class="plus"><i class="fas fa-chevron-down"></i></div>
                    <div class="minus"><i class="fas fa-chevron-up"></i></div>
                </h3>
            </div>

            <div class="sub-section" style="display:block;">
                <div class="control">
                    <span class="control-label">Temperature</span>
                    <span class="control-unit">K</span> <br>
                    <input class="textinput" id="T-val" type="number" value="296.15" onchange="updater()">
                </div>

                <div class="control">
                    <span class="control-label">Pressure</span>
                    <span class="control-unit">atm</span> <br>
                    <input class="textinput" id="p-val" type="number" value="1" onchange="updater()">
                </div>

                <div class="control">
                    <span class="control-label">Gas</span> <br>
                    <select class="textinput" name="gas-val" id="gas-val" value="Air" onchange="updater()">
                        <option value="Air">Air</option>
                        <option value="Ar">Ar</option>
                        <option value="He">He</option>
                        <option value="H2">H2</option>
                        <option value="CH4">CH4</option>
                        <option value="C2H6">C2H6</option>
                        <option value="C4H10">C4H10</option>
                        <option value="N2O">N2O</option>
                        <option value="CO2">CO2</option>
                    </select>
                </div>
                <script src="gases.json"></script> <!-- Load gas properties -->

                <div class="control">
                    <span class="control-label">Viscosity</span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="mu-val">-</div> Pa·s
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">Mean free path</span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="lam-val">-</div> nm
                    </div>
                </div>
            </div>

        </div>

        <div class="section">

            <div onclick="expandText(this);" class="h3-container">
                <h3 class="active">
                    MASS-MOBILITY RELATIONSHIP
                    <div class="plus"><i class="fas fa-chevron-down"></i></div>
                    <div class="minus"><i class="fas fa-chevron-up"></i></div>
                </h3>
            </div>
            
            <div class="sub-section" style="display:block;">
                <div class="note">
                    This section sets the mass-mobility parameters and shape factor
                    used throughout the rest of the web app. Note that ρ<sub>eff,100</sub>
                    is the effective density of a particle having a mobility diameter of
                    100 nm. Potential pairings include:
                </div>
                
                <div class="sub-note" onclick="setMassMobProp(510, 2.48)">
                    <b>Soot</b><a class="footnote" href="#foot1"><sup>1</sup></a> <br>
                    ρ<sub>eff,100</sub> = 510 kg/m<sup>3</sup> <br>
                    D<sub>m</sub> = 2.48
                </div>

                <div class="sub-note" onclick="setMassMobProp(2160, 2.97)">
                    <b>Salt</b><a class="footnote" href="#foot2"><sup>2</sup></a> <br>
                    ρ<sub>eff,100</sub> = 2160 kg/m<sup>3</sup> <br>
                    D<sub>m</sub> = 2.97
                </div>

                <div class="sub-note" onclick="setMassMobProp(1000, 3)">
                    <b>Water</b> <br>
                    ρ<sub>eff,100</sub> = 1000 kg/m<sup>3</sup> <br>
                    D<sub>m</sub> = 3
                </div>
            </div>

            <div class="sub-section" style="display:block;">
                <div class="control">
                    <span class="control-label">ρ<sub>eff,100</sub></span>
                    <span class="control-unit">kg/m<sup>3</sup></span> <br>
                    <input class="textinput" id="rho100-val" type="number" value="510" onchange="updater()">
                </div>

                <div class="control">
                    <span class="control-label">Mass-mobility exponent (D<sub>m</sub>)</span> <br>
                    <input class="textinput" id="zet-val" type="number" step="0.01" value="2.48" onchange="updater()">
                </div>

                <div class="control">
                    <span class="control-label">Shape factor</span> <br>
                    <input class="textinput" id="chi-val" type="number" step="0.01" value="1" onchange="updater()">
                </div>

                <br>

                <div class="control">
                    <span class="control-label">Pre-factor (k, m<sub>0</sub>)</span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="m0-val">-</div> fg
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">m @ 100 nm (m<sub>100</sub>)</span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="m100-val">-</div> fg
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">ρ<sub>eff,100</sub></span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="rho100-valo">-</div> kg/m<sup>3</sup>
                    </div>
                </div>
            </div>

        </div>


        <div class="section">

            <div onclick="expandText(this);" class="h3-container">
                <h3 class="active">
                    EQUIVALENT SIZES
                    <div class="plus"><i class="fas fa-chevron-down"></i></div>
                    <div class="minus"><i class="fas fa-chevron-up"></i></div>
                </h3>
            </div>

            <div class="sub-section" style="display:block;">
                <p>
                    Mass and effective density at the chosen mobility diameter are computed via the
                    mass-mobility relation. Cunningham slip corrections are calculated via the
                    expressions of Kim et al.
                </p>
            </div>

            <div class="sub-section">

                <div class="control">
                    <span class="control-label">Mobility diameter</span>
                    <span class="control-unit">nm</span> <br>
                    <input class="textinput" id="dm-val" type="number" step="0.1" value="75" onchange="updater()">
                </div>

                <div class="control">
                    <span class="control-label">Knudsen number (Kn)</span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="Kn-val">-</div>
                    </div>
                </div>

                <br>

                <div class="control">
                    <span class="control-label">Mass</span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="m-val">-</div> fg
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">ρ @ d<sub>m</sub></span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="rho-val">-</div> kg/m<sup>3</sup>
                    </div>
                </div>

                <br>
                <div class="control">
                    <span class="control-label">Cunningham slip @ d<sub>m</sub></span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="Cc-val">-</div>
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">Cunningham slip @ d<sub>a</sub></span> <br>
                    <div class="textoutput">
                        <div class="output-div" id="Cca-val">-</div>
                    </div>
                </div>

                <br>
                <div class="control">
                    <span class="control-label">Volume eq. diameter</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="dve-val">-</div> nm
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">Volume eq. diameter (no slip)</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="dves-val">-</div> nm
                    </div>
                </div>

                <br>
                <div class="control">
                    <span class="control-label">Aerodynamic diameter</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="da-val">-</div> nm
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">Aero. diameter (no slip)</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="das-val">-</div> nm
                    </div>
                </div>

                <br>

                <div class="control">
                    <span class="control-label">Mechanical mobility (B)</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="B-val">-</div> m/(N·ns)
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">Electrical mobility (Z<sub>p</sub>)</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="Zp-val">-</div> cm<sup>2</sup>/(V·s)
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">Diffusion coefficient (D)</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="D-val">-</div> cm<sup>2</sup>/s
                    </div>
                </div>
            </div>
        </div>


        <div class="section">

            <div onclick="expandText(this);" class="h3-container">
                <h3 class="active">
                    DISTRIBUTION MOMENTS
                    <div class="plus"><i class="fas fa-chevron-down"></i></div>
                    <div class="minus"><i class="fas fa-chevron-up"></i></div>
                </h3>
            </div>
            
            <div class="sub-section" style="display:block;">
                <p class="note">
                    This section computed equivalent distribution moments using a combination of
                    Hatch-Choate and the above size conversions. Moments include: <br>
                    <b>CMD</b> - Count median (mobility) diameter <br>
                    <b>MMD</b> - Mass median (mobility) diameter <br>
                    <b>CMAD</b> - Count median aerodynamic diameter <br>
                    <b>MMAD</b> - Mass median aerodynamic diameter <br>
                    <b>CMM</b> - Count median single particle mass <br>
                    <b>MMM</b> - Mass median single particle mass
                </p>
            </div>

            <div class="sub-section">
                <div class="control">
                    <span class="control-label">CMD</span>
                    <span class="control-unit">nm</span> <br>
                    <input class="textinput" id="cmd-val" type="number" step="0.1" value="75" onchange="updater()">
                </div>

                <div class="control">
                    <span class="control-label">GSD</span> <br>
                    <input class="textinput" id="sg-val" type="number" min="1" max="20" step="0.01" value="1.8"
                        onchange="updater()">
                </div>

                <br>

                <div class="control">
                    <span class="control-label">MMD</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="mmd-val">-</div> nm
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">CMAD</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="cmad-val">-</div> nm
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">MMAD</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="mmad-val">-</div> nm
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">CMM</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="cmm-val">-</div> fg
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">MMM</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="mmm-val">-</div> fg
                    </div>
                </div>

                <div class="control">
                    <span class="control-label">GSD (for m<sub>p</sub>)</span><br>
                    <div class="textoutput">
                        <div class="output-div" id="smp-val">-</div>
                    </div>
                </div>

                <!-- Create a div where the graph will take place -->
                <div style="height:20px;"></div>
                <div id="my_dataviz"></div>
            </div>
        </div>

        <!-- Gas properties are loaded above. -->
        <script src="autils.js"></script>
        <script src="output.js"></script>

        <div class="footer">
            <b>Footnotes</b> <br>
            <sup id="foot1">1</sup> Olfert and Rogak, Aerosol Sci. Technol. (2019). <br>
            <sup id="foot2">2</sup> Sipkens et al., Submitted (2021). <br>
            <sup>*</sup> This web app is currently under construction and has not been fully validated. <br>
            <sup>*</sup> Roughly equivalent MATLAB code is available <a
                href="https://github.com/tsipkens/autils">here</a>.
        </div>

    </div>

</body>

<!-- theme toggle -->
<script>
    const btn = document.querySelector("#btn-toggle-click");
    btn.addEventListener("click", function () {
        // Toggle dark theme.
        dark = !dark;

        toggleNight(); // apply theme
    })

    /* To expand subsections */
    var coll = document.getElementsByClassName("section");
    var i;

    function expandText(item) {
        content = item.parentElement.children
        var button = content[0]; // button, h3 container
        var h3 = button.children[0];
        var plus = h3.children[0];
        var minus = h3.children[1];
        var content2 = []; // content other than header
        for (ii = 1; ii < content.length; ii++) {
            content2.push(content[ii]);
        }
        if (content2[0].style.display === "block") {
            for (ii = 0; ii < content2.length; ii++) {
                content2[ii].style.display = "none";
            }
            plus.style.display = "inline";
            minus.style.display = "none";
            button.style.borderBottom = "none";
            button.style.borderBottomLeftRadius = "7px";
            button.style.borderBottomRightRadius = "7px";
            setTimeout(function () {
                item.style.maxHeight = button.scrollHeight + "px";
            }, 500);
        } else {
            for (ii = 0; ii < content2.length; ii++) {
                content2[ii].style.display = "block";
            }
            plus.style.display = "none";
            minus.style.display = "inline";
            button.style.borderBottom = "solid 1px var(--line-color)";
            button.style.borderBottomLeftRadius = "0px";
            button.style.borderBottomRightRadius = "0px";
            setTimeout(function () {
                item.style.maxHeight = item.scrollHeight + "px";
            }.bind(item), 40);
        }
    }
</script>
